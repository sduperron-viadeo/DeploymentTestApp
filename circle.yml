machine:
  xcode:
    version: "8.2"

dependencies:
  pre:
    - brew bundle
    - bundle install

checkout:
  post:
    - git submodule sync
    - git submodule update --init

test:
  override:
    - bundle exec fastlane run_ci
  post:
    - mkdir -p $CIRCLE_TEST_REPORTS/junit/
    - cp $CIRCLE_ARTIFACTS/report.junit $CIRCLE_TEST_REPORTS/junit/test_report.xml

deployment:
  alpha:
    tag: /alpha\/.*/
    commands:
      - bundle exec fastlane alpha_build_and_upload
